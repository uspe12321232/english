<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>英単語テスト</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    #header {
      padding: 10px;
      text-align: center;
      background-color: #f8f8f8;
      border-bottom: 1px solid #ccc;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #header button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
    }
    #main {
      padding: 30px 20px 100px; /* 下部の固定ボタン分の余白を確保 */
      max-width: 800px;
      margin: 0 auto;
    }
    #quiz-box input {
      width: 300px;
      font-size: 18px;
      text-align: center;
    }
    .hidden { display: none; }
    #result-box {
      margin-top: 30px;
      width: 100%;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
    }
    .result-item {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    /* 進む・戻るボタンを画面下に固定 */
    #controls {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(248, 248, 248, 0.95);
      border-top: 1px solid #ccc;
      padding: 12px 16px;
      display: flex;
      gap: 12px;
      justify-content: center;
      z-index: 20;
    }
    #controls button {
      padding: 10px 18px;
      font-size: 16px;
      cursor: pointer;
    }
    /* キーボードショートカットのヒント */
    #hint {
      color: #555;
      font-size: 13px;
      margin-top: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="header">
    <button onclick="startQuiz('all')">全問モード</button>
    <button onclick="startQuiz('random')">ランダムモード</button>
  </div>

  <div id="main">
    <div id="quiz-box" class="hidden">
      <p id="question-number"></p>
      <div id="question-text"></div>
      <input type="text" id="user-answer" placeholder="英単語を入力">
      <div id="hint">← 前の問題 / → 次の問題 / Enter 最終問題で採点ページへ</div>
    </div>

    <div id="result-page" class="hidden">
      <h2>最後の問題が終わりました！</h2>
      <button onclick="showResults()">採点する</button>
      <button onclick="backToLastQuestion()">戻る</button>
    </div>

    <div id="result-box" class="hidden"></div>
  </div>

  <!-- 画面下部固定の操作ボタン -->
  <div id="controls" class="hidden">
    <button id="prev-btn" onclick="prevQuestion()">戻る ←</button>
    <button id="next-btn" onclick="nextQuestion()">次へ →</button>
    <button id="result-btn" onclick="goToResultPage()" style="display:none;">採点ページへ</button>
  </div>

  <!-- 外部JSファイル（問題データ） -->
  <script src="quizData.js"></script>

  <script>
    let quiz = [];
    let userAnswers = [];
    let currentIndex = 0;

    function startQuiz(mode) {
      quiz = (mode === 'random') ? shuffleArray(quizData).slice(0, 10) : [...quizData];
      userAnswers = Array(quiz.length).fill("");
      currentIndex = 0;

      document.getElementById("result-box").classList.add("hidden");
      document.getElementById("result-page").classList.add("hidden");
      document.getElementById("quiz-box").classList.remove("hidden");
      document.getElementById("controls").classList.remove("hidden");

      showQuestion();
    }

    function shuffleArray(array) {
      return array.map(v => ({ v, r: Math.random() }))
                  .sort((a, b) => a.r - b.r)
                  .map(obj => obj.v);
    }

    function showQuestion() {
      const q = quiz[currentIndex];
      document.getElementById("question-number").textContent = `問題 ${currentIndex + 1} / ${quiz.length}`;
      document.getElementById("question-text").innerHTML = `
        <div style="margin-bottom:10px; font-size:18px;">${q.sentence}</div>
        <div>${q.japanese}</div>
      `;
      document.getElementById("user-answer").value = userAnswers[currentIndex];
      document.getElementById("user-answer").focus();

      const nextBtn = document.getElementById("next-btn");
      const resultBtn = document.getElementById("result-btn");

      if (currentIndex === quiz.length - 1) {
        nextBtn.style.display = "none";
        resultBtn.style.display = "inline-block";
      } else {
        nextBtn.style.display = "inline-block";
        resultBtn.style.display = "none";
      }
    }

    function nextQuestion() {
      userAnswers[currentIndex] = document.getElementById("user-answer").value.trim();
      if (currentIndex < quiz.length - 1) {
        currentIndex++;
        showQuestion();
      }
    }

    function prevQuestion() {
      userAnswers[currentIndex] = document.getElementById("user-answer").value.trim();
      if (currentIndex > 0) {
        currentIndex--;
        showQuestion();
      }
    }

    function goToResultPage() {
      userAnswers[currentIndex] = document.getElementById("user-answer").value.trim();
      document.getElementById("quiz-box").classList.add("hidden");
      document.getElementById("controls").classList.add("hidden");
      document.getElementById("result-page").classList.remove("hidden");
    }

    function backToLastQuestion() {
      document.getElementById("result-page").classList.add("hidden");
      document.getElementById("quiz-box").classList.remove("hidden");
      document.getElementById("controls").classList.remove("hidden");
      showQuestion();
    }

    function showResults() {
      let score = 0;
      const resultBox = document.getElementById("result-box");
      resultBox.innerHTML = "<h2>結果</h2>";

      quiz.forEach((q, i) => {
        const user = (userAnswers[i] || "").trim();
        const correct = q.english;
        const isCorrect = user.toLowerCase() === correct.toLowerCase();
        if (isCorrect) score++;

        const item = document.createElement("div");
        item.className = "result-item";

        const mark = isCorrect
          ? '<span style="color:green; font-weight:bold;">✓ 正解</span>'
          : '<span style="color:red; font-weight:bold;">× 不正解</span>';

        item.innerHTML = `
          <div><strong>問題 ${i + 1}</strong></div>
          <div>英文: ${q.sentence}</div>
          <div>和訳: ${q.japanese}</div>
          <div>自分の回答: ${user}</div>
          <div>正しい答え: ${correct}</div>
          <div>${mark}</div>
        `;
        resultBox.appendChild(item);
      });

      const summary = document.createElement("p");
      summary.style.fontWeight = "bold";
      summary.textContent = `正解数: ${score} / ${quiz.length}`;
      resultBox.appendChild(summary);
      resultBox.classList.remove("hidden");
    }

    // キーボード操作: 左矢印で戻る、右矢印で次へ、Enterで最終問題なら採点へ
    window.onload = () => {
      startQuiz('all');

      const answerInput = document.getElementById("user-answer");

      // Enter キー
      answerInput.addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          event.preventDefault();
          if (currentIndex < quiz.length - 1) {
            nextQuestion();
          } else {
            goToResultPage();
          }
        }
      });

      // 矢印キー（入力欄にフォーカスがあっても効くように、documentに付ける）
      document.addEventListener("keydown", function(event) {
        // 左矢印: 前の問題へ
        if (event.key === "ArrowLeft") {
          event.preventDefault();
          prevQuestion();
        }
        // 右矢印: 次の問題へ（最終問題では採点ページへ）
        if (event.key === "ArrowRight") {
          event.preventDefault();
          if (currentIndex < quiz.length - 1) {
            nextQuestion();
          } else {
            goToResultPage();
          }
        }
      });
    };
  </script>
</body>
</html>